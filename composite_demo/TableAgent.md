# TableAgent

> 2024-09-05

## 1. 任务简介

### 1.1 任务目标

使用大语言模型（LLM）进行数据分析和可视化，通过自然语言与 LLM 交互生成 Python 代码，分析和可视化文本中的数据。

### 1.2 任务概述

1. 数据处理：设计合适的 prompt，指示 LLM 生成输出，读取文本文件，去除表头表尾，另存为一个新CSV 文件。
2. 数据分析：读取预处理后的 CSV 文件，设计合适的 prompt，指示 LLM 生成 Python 代码，对单个 CSV 文件进行增删改查以及数据可视化。
   1. 计算近 10 年各地区的人口均值、最大值和最小值，按列添加到表的最后。
   2. 以饼状图的形式，可视化近 10 年各地区的平均人口比例。
   3. 以折线图的形式，可视化近 10 年浙江省的人口变化趋势。
3. 仅使用本地大语言模型。



## 2. 具体实现

### 2.1 模型选取

项目选用了 **ChatGLM3** 模型，这是一款由清华大学和智谱AI联合开发的开源大规模语言模型，专注于中文自然语言处理任务，具备高效的推理性能和生成能力。同时该模型支持本地化部署，可以在无网络的环境中完成所有分析与可视化任务。

### 2.2 处理过程

使用了 `tool_chain`，其原理是将多个步骤的指令串联在一起，通过每一步生成的代码和数据输出作为下一个步骤的输入。这个工具链能够高效地将自然语言指令转化为具体的 Python 代码，实现自动化的数据处理与分析任务。每个步骤都会在执行过程中验证输出结果的正确性，确保生成的代码符合预期，并可以根据需要调整 Prompt 以优化生成的代码。

### 2.3 tool_functions定义



### 2.4 用户交互







## 3. 部署指南

克隆本项目github代码：

```powershell
git clone https://github.com/THUDM/ChatGLM3
cd ChatGLM3
```

创建虚拟环境：

```text
conda create -n chatglm python=3.11
conda activate chatglm
```

安装依赖：

```text
pip install -r requirements.txt
```

下载模型：

```
git clone https://www.modelscope.cn/ZhipuAI/chatglm3-6b.git
```

根据下载的路径更改



## 附录：最终效果

* 表头表尾去除：

  ![image-20240905190058535](assets/image-20240905190058535.png)

  ![image-20240905190114072](assets/image-20240905190114072.png)

* 平均值计算并添加

  ![image-20240905192248986](assets/image-20240905192248986.png)

  ![image-20240905192324317](assets/image-20240905192324317.png)

* 最大、最小值添加

  ![image-20240905193730947](assets/image-20240905193730947.png)

  ![image-20240905193743009](assets/image-20240905193743009.png)

* 删除行、列

  ![image-20240905200319083](assets/image-20240905200319083.png)

  ![image-20240905200336148](assets/image-20240905200336148.png)

  ![image-20240905200355278](assets/image-20240905200355278.png)

* 增加行、列

  ![image-20240905201921918](assets/image-20240905201921918.png)

  ![image-20240905201933274](assets/image-20240905201933274.png)

* 更新数据

  ![image-20240905205451660](assets/image-20240905205451660.png)

  ![image-20240905205501924](assets/image-20240905205501924.png)

* 画饼状图

  ![image-20240905211739077](assets/image-20240905211739077.png)

  ![image-20240905211759885](assets/image-20240905211759885.png)

* 画折线图

  ![image-20240905212649348](assets/image-20240905212649348.png)

  ![image-20240905212637264](assets/image-20240905212637264.png)

  

  